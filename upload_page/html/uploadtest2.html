<html lang="zh-CN">
	<head>
    <meta charset="utf-8">
	</head>
	<body>
	　　<form id="upload-form" action="action.php" method="post" enctype="multipart/form-data" >
	　　　　<input type="file" id="upload" name="upload" /> <br />
	　　　　<input type="submit" value="Upload" />
		</form>
		
		上传进度:
		<progress value="0" min="0" max="100" id="uploadprogress"></progress>
	</body>
</html>

<script src="/js/jquery-2.1.4.min.js"></script>
<script type="text/javascript">

function update_progress(e) {

	if(e.lengthComputable) {
		var max = e.total;
		var current = e.loaded;

		var percent = (current / max * 100 | 0);
		if (percent <= 99) {
			$('#uploadprogress').attr("value", percent);
		}
	} 
}

function success_upload(e) {
	$('#uploadprogress').attr("value", 100);
	console.log("uplod xxxxx success");
}
$(document).ready(function() {

		$('form').on('submit', function(e) {
			var formdata = new FormData();		
			formdata.append('upload', $('#upload')[0].files[0]);

			$.ajax({
				type: "POST",		
				url : "http://www.speed.com/action.php",
				data: formdata,
				xhr: function() {
					var myxhr = $.ajaxSettings.xhr();
					if(myxhr.upload){
						myxhr.upload.addEventListener('progress',update_progress, false);
						myxhr.upload.addEventListener('load', success_upload, false);
					}
					return myxhr;
				},
				cache: false,
				contentType: false,
				processData: false,
				success: function(data) {
					console.log("upload success");	
				},
				error: function(data) {
					console.log("upload error");			
				}
			});

			e.preventDefault();
		});
});
</script>

